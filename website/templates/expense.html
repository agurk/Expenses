{% extends "layout.html" %}
{% block title %}Expense{% endblock %}
{% block body %}


<script src=/static/js/edit_expense.js></script>
<script src=/static/js/date_field.js></script>

<div class="row">
  <div class="col-sm-5"><h3>Expense <small>{% if expense['eid'] %}{{ expense['eid'] }}{% else %}[new]{% endif %}</small></h3></div>

	<div class="col-sm-7 h2">
	<div class="btn-toolbar">
		<div class="btn-group">
		<button class="btn btn-danger" type="button" onclick="delete_expense({{ expense['eid'] }})">Delete</button>
		</div>
		
		<div class="btn-group pull-right">
		{% if expense['eid'] %}
			<button class="btn btn-primary" type="button" onclick="save_expense({{ expense['eid'] }})">Save</button>
		{% else %}
			<button class="btn btn-primary" type="button" onclick="save_expense('NEW')">Save</button>
		{% endif %}
		</div>
		<div class="btn-group pull-right">
		<button class="btn btn-default" type="button" onclick="duplicate_expense({{ expense['eid'] }})">Duplicate</button>
		</div>
		<div class="btn-group pull-right">
            <div class="btn btn-default" onclick="reprocess_expense({{ expense['eid'] }})">
                Reprocess
            </div>
		</div>
		<div class="btn-group pull-right">
			<button class="btn btn-default" type="button" onclick="merge_expense({{ expense['eid'] }})">Merge</button>
			<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			<span class="caret"></span>
			<span class="sr-only">Toggle Dropdown</span>
			</button>
			<div class="dropdown-menu">
				<button class="btn btn-default" type="button" onclick="merge_expense_commission({{expense['eid'] }})">Merge as Commission</button>
			</div>
		</div>


	</div>
	</div>
</div>

<br>

<div class="row">
    <div class="col-sm-8">
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">Description</span>
		        <input class="form-control" id="exDesc" text="text" value="{{ expense['description']  }}"></input>
                </div>
            </div>
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">Details</span>
		        <textarea class="form-control" id="exDeetDesc" placeholder="none">{{ expense['detaileddescription']  }}</textarea>
                </div>
            </div>
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">Classification</span>
                <select id="exClass" class="form-control">
                {% for row in classifications -%}  
                <option value="{{ row[0] }}" {% if  row[1] == expense['classification'] -%} selected="selected" {%- endif %}>{{ row[1] }}</option>
                {%- endfor %}
                </select>
                </div>
            </div>
            <div class="row-sm-12">
	            {% for document in expense['documents'] -%}
		            {% include 'document_fragment.html' %}
	            {%- endfor %}
            </div>
            {% if expense['relatedExpenses'] -%}
            <div class="row-sm-12">
                Related Expenses
                {% for relatedEx in expense['relatedExpenses'] -%}
                    <a href="expense?eid={{relatedEx['eid'] }}">{{relatedEx['description']}}</a>
                {%- endfor %}
            </div>
		    {% endif %}
        </div>


        <div class="col-sm-4">
            <div class="row-sm-12">
		        <div class="input-group">
			    <span id="exCCY" class="input-group-addon expense-addon">{{ expense['ccy'] }}</span>
			    <input class="form-control" id="exAmount" text="number" value="{{ expense['amount']  }}"></input>
		        </div>
            </div>
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">Date</span>
		        <input class="form-control" id="exDate" text="text" value="{{ expense['date']  }}" onkeydown="cursor_date(event, 'exDate')"></input>
                </div>
            </div>
       <br> 
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">FX amount</span>
		        <input class="form-control" id="exFXAmount" text="text" value="{{ expense['fxamount']  }}"></input>
                </div>
            </div>
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">FX currency</span>
		        <input class="form-control" id="exFXCCY" text="text" value="{{ expense['fxccy']  }}"></input>
                </div>
            </div>
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">FX Rate</span>
		        <input class="form-control" id="exFXRate" text="text" value="{{ expense['fxrate']  }}"></input>
                </div>
            </div>
            <div class="row-sm-12">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">Commission</span>
		        <input class="form-control" id="exCommission" text="text" value="{{ expense['fxcommission']  }}"></input>
                </div>
            </div>
        </div>
    </div>

<br>
<div class="row-sm-12">
	<div class="row-sm-12">
	    <a href="#rawlines"  data-toggle="collapse"><h2>+ Details</h2></a>
	</div>
</div>
<div class="row-sm-12 collapse" id="rawlines">

    <div class="row">
    <div class="col-sm-6">
	    <div class="input-group">
		    <span class="input-group-addon expense-addon">Account</span>
            <select id="exAccount" class="form-control" onchange="$('#exCCY').text($('#exAccount option:selected').data('ccy'))">
            {% for account in accounts -%}  
            <option value="{{ account['aid'] }}" {% if  account['aid'] == expense['aid'] -%} selected="selected" {%- endif %} data-ccy="{{ account['ccy'] }}" >{{ account['name'] }}</option>
            {%- endfor %}
            </select>
        </div>
    </div>

    <div class="col-sm-6">
		        <div class="input-group disabled">
			    <span class="input-group-addon expense-addon">Transaction Ref</span>
		        <input class="form-control" id="exCommission" text="text" value="{{ expense['reference']  }}"></input>
                </div>
    </div>
    </div>
    <br>
    <div class="row">
    <div class="col-sm-6">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">Modified</span>
		        <input class="form-control" id="exCommission" text="text" value="{{ expense['modified']  }}"></input>
                </div>
    </div>
    <div class="col-sm-6">
		        <div class="input-group">
			    <span class="input-group-addon expense-addon">Process Date</span>
		        <input class="form-control" id="exProcDate" text="text" value="{{ expense['processdate']  }}"></input>
                </div>
    </div>
    </div>

<br>
    <h3>Raw Data</h3>

	{% for rawline in expense['rawlines'] -%}
		<div class="col-sm-2">{{ rawline[0] }}</div>
		<div class="col-sm-10">{{ rawline[1] }}</div>
	{%- endfor %}
</div>


{% endblock %}


